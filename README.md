# 手部关节传感器可视化系统

一个现代化的网页应用程序，用于实时监控和可视化手部关节传感器的数据。

## 功能特性

- **实时串口通信**: 通过Web Serial API读取手部关节传感器数据
- **数据帧协议支持**: 完整支持串口数据帧通信协议
- **串口配置管理**: 支持动态配置波特率、数据位、停止位、校验位等参数
- **端口信息显示**: 显示当前连接的串口设备详细信息
- **手部布局进度条**: 15个关节角度以进度条形式平铺显示，模拟手部布局
- **15个关节监控**: 支持大拇指、食指、中指、无名指、小指的所有关节角度
- **系统命令控制**: 心跳测试、版本获取、状态查询等系统命令
- **多种校准模式**: 支持5点校准、快速校准、锚定点校准
- **传感器数据控制**: 开启/关闭数据打印，获取实时数据
- **校准参数管理**: 获取、设置、保存、加载校准参数
- **配置持久化**: 串口配置自动保存到本地存储
- **现代化UI**: 响应式设计，支持深色主题
- **实时数据可视化**: 进度条和数值显示关节角度
- **交互式控制**: 支持重置数值、动画效果等操作

## 技术栈

- **前端框架**: 原生JavaScript (ES6+)
- **串口通信**: Web Serial API + 数据帧协议
- **样式**: CSS3 with CSS Grid & Flexbox
- **构建工具**: 无需构建，直接运行

## 浏览器兼容性

- ✅ Chrome 89+
- ✅ Edge 89+
- ✅ Opera 75+
- ❌ Firefox (不支持Web Serial API)
- ❌ Safari (不支持Web Serial API)

## 数据帧协议

本系统支持完整的串口数据帧通信协议：

### 帧格式
```
+----------+----------+-----+--------+-----------+----------+--------+--------+
| Header0  | Header1  | Cmd | Length | Data[0-N] | Checksum | Tail0  | Tail1  |
+----------+----------+-----+--------+-----------+----------+--------+--------+
|   0xAA   |   0x55   | 1B  |   1B   | N Bytes   |    1B    |  0x0D  |  0x0A  |
+----------+----------+-----+--------+-----------+----------+--------+--------+
```

### 支持的命令

#### 系统命令
- **心跳测试** (0x01): 测试设备连接状态
- **获取版本** (0x02): 获取固件版本信息
- **获取状态** (0x03): 获取系统运行状态

#### 校准命令
- **5点校准**: 开始(0x10)、下一步(0x11)、重置(0x12)、获取状态(0x13)
- **快速校准**: 开始(0x20)、完成(0x21)、重置(0x22)、获取状态(0x23)
- **锚定点校准**: 开始(0x30)、记录(0x31)、应用(0x32)、重置(0x33)、获取状态(0x34)

#### 传感器控制
- **开启数据打印** (0x40): 开启传感器数据串口输出
- **关闭数据打印** (0x41): 关闭传感器数据串口输出
- **获取数据** (0x42): 获取当前传感器数据

#### 参数管理
- **获取参数** (0x50): 获取指定传感器的校准参数
- **设置参数** (0x51): 设置指定传感器的校准参数
- **保存参数** (0x52): 保存校准参数到Flash
- **加载参数** (0x53): 从Flash加载校准参数

## 快速开始

### 1. 下载项目文件

确保所有文件都在同一目录下：
- `index.html` - 主页面
- `styles.css` - 样式文件
- `serial.js` - 串口通信模块
- `hand-svg.js` - 平面SVG模型模块
- `app.js` - 主应用程序

### 2. 启动应用

1. 使用支持的浏览器打开 `index.html`
2. 配置串口参数（波特率、数据位等）
3. 点击"连接串口"按钮
4. **在浏览器弹出的设备选择对话框中选择对应的串口设备**
5. 开始实时监控关节数据

> **注意**: Web Serial API 出于安全考虑，不允许网页直接获取可用端口列表。用户必须通过浏览器提供的设备选择对话框来选择串口设备。

### 3. 操作说明

#### 串口配置
- **波特率**: 支持9600到921600多种波特率
- **数据位**: 7位或8位数据位
- **停止位**: 1位或2位停止位
- **校验位**: 无校验、偶校验、奇校验
- **流控制**: 无流控制或硬件流控制
- **超时设置**: 100ms到10000ms超时时间
- **保存配置**: 将当前配置保存到本地存储
- **加载配置**: 从本地存储加载保存的配置
- **重置配置**: 恢复默认串口配置

#### 系统命令
- **心跳测试**: 测试与设备的连接状态
- **获取版本**: 获取设备固件版本信息
- **获取状态**: 获取设备运行状态

#### 校准功能
- **5点校准**: 通过5个步骤完成传感器校准
- **快速校准**: 自动校准模式，适合快速设置
- **锚定点校准**: 精确校准特定手指的锚定点

#### 传感器控制
- **开启数据打印**: 在串口输出传感器数据
- **关闭数据打印**: 停止串口数据输出
- **获取数据**: 手动获取当前传感器数据

#### 参数管理
- **获取参数**: 查看指定传感器的校准参数
- **设置参数**: 修改传感器的校准参数
- **保存参数**: 将参数保存到设备Flash
- **加载参数**: 从Flash加载保存的参数

#### 平面模型控制
- **关节点击**: 点击关节查看详细信息
- **重置视图按钮**: 恢复默认关节位置
- **动画模式按钮**: 切换关节动画效果

#### 键盘快捷键
- `R`: 重置平面模型视图
- `A`: 切换动画模式
- `C`: 连接/断开串口

## 项目结构

```
EXHandWeb/
├── index.html          # 主HTML文件
├── styles.css          # 样式文件
├── serial.js           # 串口通信模块
├── hand-svg.js         # 平面SVG手部模型
├── app.js              # 主应用程序
└── README.md           # 说明文档
```

## 配置选项

### 串口设置
默认配置：
- **波特率**: 115200
- **数据位**: 8
- **停止位**: 1
- **校验位**: 无
- **流控制**: 无

### SVG模型设置
- **视图框**: 400x300
- **关节半径**: 8px
- **骨骼宽度**: 3px
- **动画持续时间**: 1秒

## 故障排除

### 常见问题

1. **浏览器不支持Web Serial API**
   - 解决方案: 使用Chrome、Edge或Opera浏览器

2. **无法连接串口**
   - 检查设备是否正确连接
   - 确认串口未被其他程序占用
   - 检查波特率设置是否正确

3. **数据不更新**
   - 检查传感器是否正常工作
   - 确认数据格式是否正确
   - 查看浏览器控制台错误信息

4. **平面模型不显示**
   - 检查SVG元素是否正确创建
   - 确认CSS样式是否正确加载
   - 查看浏览器控制台错误信息

### 调试模式

打开浏览器开发者工具查看详细日志：
1. 按F12打开开发者工具
2. 切换到Console标签
3. 查看实时日志信息

## 开发说明

### 扩展功能

1. **添加新的关节类型**
   - 修改 `serial.js` 中的数据包大小
   - 更新 `hand-svg.js` 中的关节配置
   - 调整 `app.js` 中的数据解析逻辑

2. **自定义平面模型**
   - 修改 `hand-svg.js` 中的SVG元素创建
   - 调整关节位置和颜色设置
   - 添加新的动画效果

3. **UI主题定制**
   - 修改 `styles.css` 中的CSS变量
   - 调整颜色方案和布局
   - 添加新的交互效果

### 性能优化

- 使用 `requestAnimationFrame` 进行动画渲染
- 合理设置SVG元素的更新频率
- 优化数据更新频率
- 使用CSS动画提升性能

## 许可证

MIT License - 详见LICENSE文件

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 支持15个关节角度监控
- 手部布局进度条可视化
- 完整的数据帧协议支持
- 串口配置管理功能
- 配置持久化存储
- 系统命令控制功能
- 多种校准模式支持
- 传感器数据控制
- 校准参数管理
- 串口通信功能
- 现代化UI设计
